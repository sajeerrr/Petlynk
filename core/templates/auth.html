{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/auth.css' %}">
{% endblock %}

{% block navbar %}{% endblock %}
{% block footer %}{% endblock %}

{% block layout %}

<!-- 
    The 'sign-up-mode' class is toggled by JS.
    If mode == 'register' from Django context, we add it initially.
-->
<div class="auth-container {% if mode == 'register' %}sign-up-mode{% endif %}">

    <div class="forms-container">
        <div class="signin-signup">

            <!-- Login Form -->
            <form action="{% url 'login' %}" method="POST" class="sign-in-form">
                {% csrf_token %}
                <h2 class="title">Sign in</h2>

                {% if error %}
                <div class="alert alert-danger p-2 mb-3" style="width: 100%; font-size: 0.9rem;">
                    {{ error }}
                </div>
                {% endif %}

                <div class="input-field">
                    <i class="fas fa-user"></i>
                    <input type="text" name="username" placeholder="Username" required />
                </div>
                <div class="input-field">
                    <i class="fas fa-lock"></i>
                    <input type="password" name="password" placeholder="Password" required />
                </div>
                <button type="submit" class="btn btn-primary-custom" style="width: 150px; margin-top: 20px;">
                    Login
                </button>
            </form>

            <!-- Register Form -->
            <form action="{% url 'register' %}" method="POST" class="sign-up-form">
                {% csrf_token %}
                <h2 class="title">Sign up</h2>

                <!-- We can render the form fields manually or loop them -->
                <!-- Assuming standard RegisterForm with username, email, password -->

                {% for field in form %}
                <div class="input-field">
                    <i class="fas fa-pen"></i> <!-- Generic icon, can be customized based on field name -->
                    {{ field }}
                </div>
                {% if field.errors %}
                <small class="text-danger">
                    {{ field.errors.0 }}
                </small>
                {% endif %}
                {% endfor %}

                <button type="submit" class="btn btn-primary-custom" style="width: 150px; margin-top: 20px;">
                    Sign Up
                </button>
            </form>
        </div>
    </div>

    <!-- Panels (Overlay) -->
    <div class="panels-container">

        <!-- Left Panel (Visible during Login) -->
        <div class="panel left-panel">
            <div class="content">
                <h3>New here?</h3>
                <p>Join our community of pet lovers today!</p>
                <button class="btn transparent" id="sign-up-btn">
                    Sign up
                </button>
            </div>
            <!-- Animated Image Placeholder -->
            <img src="https://cdni.iconscout.com/illustration/premium/thumb/pet-care-illustration-download-in-svg-png-gif-file-formats--dog-animal-cat-love-veterinary-clinic-pack-healthcare-medical-illustrations-4546416.png"
                class="image" alt="" />
        </div>

        <!-- Right Panel (Visible during Register) -->
        <div class="panel right-panel">
            <div class="content">
                <h3>One of us?</h3>
                <p>Already have an account? Sign in and match!</p>
                <button class="btn transparent" id="sign-in-btn">
                    Sign in
                </button>
            </div>
            <!-- Animated Image Placeholder -->
            <img src="https://cdni.iconscout.com/illustration/premium/thumb/cat-playing-illustration-download-in-svg-png-gif-file-formats--yarn-ball-kitten-animal-activity-pack-nature-illustrations-4546424.png"
                class="image" alt="" />
        </div>

    </div>
</div>

<script>
    const sign_in_btn = document.querySelector("#sign-in-btn");
    const sign_up_btn = document.querySelector("#sign-up-btn");
    const container = document.querySelector(".auth-container");

    sign_up_btn.addEventListener("click", () => {
        container.classList.add("sign-up-mode");
    });

    sign_in_btn.addEventListener("click", () => {
        container.classList.remove("sign-up-mode");
    });

    // Customize input fields from Django form to match design
    // Since Django renders <input> directly, we might need to remove default classes or style them
    document.querySelectorAll('.sign-up-form input').forEach(input => {
        input.placeholder = input.name.charAt(0).toUpperCase() + input.name.slice(1);
        input.style.background = 'transparent';
        input.style.border = 'none';
        input.style.width = '100%';
    });
</script>

<style>
    /* Quick fixes for Django form rendering inside custom input-field */
    .sign-up-form .input-field input {
        background: transparent !important;
        border: none !important;
        padding: 0 10px;
        height: 100%;
        width: 100%;
    }

    .sign-up-form .input-field select {
        /* If there are selects */
        background: transparent;
        border: none;
    }
</style>

{% endblock %}